# gophkeeper

Приложение для хранения данных пользователя.
Приложение состоит из "сервера" и "клиента".
Сервер реализует следующий функционал:
- регистрация;
- авторизация;
- создание, удаление и просмотр заметок;
- создание, удаление и просмотр банковских карт;
- хранение и скачивание файлов.
Ко всем данным предусмотрена возможность сохранения метаданных в формате `key-value`.
"Клиент" реализует аналогичный функционал.

## Сервер
Сервер реализован на gRPC. gRPC используется для взаимодействия между клиентом и сервером и
функционирует в двух режимах:
- `stream` - режим стрима (загрузка и скачивание файлов);
- `unary` - режим единичного запроса (авторизация, работа с банковскими картами и тд).
Так как оба режима используют один порт, то для высоконагруженного приложения стоит использовать отдельные порты.
Логирование реализовано через библиотеку slog.
Настрой параметров сервера происходит через переменные окружения и файл конфигурации.
Для запуска сервера должны быть установлены переменные окружения:
- `CONFIG_PATH` - путь к файлу конфигурации;
- `DB_PASSWORD` - пароль для подключения к базе данных.

Файл конфигурации находится в `config/local.yaml`.

## Запуск сервера через Makefile (переменные окружения установлены)

```bash
make server
```
## База данных
База данных реализована на PostgreSQL.
Для инициализации и проведения миграций используйте команду (PostgreSQL должен быть запущен):

```bash
make migration
```
Обратите внимание, что для корректной работы миграций параметры подключения к базе данных в командной строке `make migration` должны быть идентичны параметрам, указанным в файле конфигурации `config/local.yaml`.

## Хранилище данных S3
Хранилище данных реализовано на AWS S3 (Selectel).
Для работы с хранилищем данных используется библиотека `github.com/aws/aws-sdk-go` с учетом специфики работы с S3 в регионах `ru-1`.
Хранилище используется для хранения файлов пользователя.
Настройка параметров хранилища происходит через файл конфигурации `config/local.yaml`.
База реальная, поэтому просьба не злоупотреблять! 

## Тесты
### Статические анализаторы
Для запуска статических анализаторов используйте команду:

```bash
make lint
```
Для настройки линтеров используйте файл `.golangci.yml`.

### Unit-тесты
Для запуска unit-тестов используйте команду:

```bash
make test
```
### Functional-тесты
Для запуска functional-тестов используется тестовая база данных, запускаемая через docker compose. 
Для запуска сервера с тестовой базой данных используйте команду:

```bash
make testdb
```
Тестовая база при запуске проводит миграции и будет доступна по адресу `localhost:5433`.
Имя базы данных: `test`, имя пользователя: `test`, пароль: `test`.
Тестовые данные будут доступны в контейнере с базой данных.

Для запуска functional-тестов используется клиент, созданный для тестов.
Для запуска тестов откройте отдельный терминал и выполните команду:

```bash
make test-functional
```

## Клиент
Клиент реализован на TUI.
Для запуска клиента используйте команду:

```bash
make client
```
Клиент запускается c переменной среды окружения `SERVER_CLIENT_ADDRESS` (имеют высший приоритет),
или с настройками по умолчанию, указанными в файле конфигурации `client/config/config.yaml`,
или через флаг `-server_address` (последний приоритет).

Для компиляции клиента для разных платформ используйте команду:

```bash
make client-build
``` 
Исполняемые файлы будут находиться в директории `client/build`.
